# 컨텍스트 관리자

컨텍스트 관리자는 주요 동작 전후 작업을 실행할 때 유용하다.

일반적으로 리소스 관리와 관련하여 컨텍스트 관리자를 볼 수 있다. 예를들어 파일을 열고 작업을 한 후 닫는 일, 소켓과 연결 하고 닫거나 임시 파일을 제거하는 등의 작업에서 이다.

할당된 모든 리소스를 해제하는 과정에서 예외나 오류 처리를 어떻게 해야 할까? 일반적인 방법은 finally블록에 정리 코드를 넣는 것이다.

```
fd = open(filename)
try:
	something(fd)
finally:
	fd.close()
```

위의 코드를 파이써닉하게 구현하면 다음과 같다.

```
with open(filename) as fd:
	something(fd)
```

with문은 컨텍스트 관리자로 진입하게 한다. 이 경우 open함수는 컨텍스트 관리자 프로토콜을 구현한다. 즉, 예외가 발생해도 블록이 완료되면 파일이 자동으로 닫힌다. 

컨텍스트 관리자는 \_\_enter\_\_와 \_\_exit\_\_ 두개의 매직 메서드로 구성된다. 첫 줄에서 with문은 \_\_enter\_\_메서드를 호출하고 반환 값이 fd에 저장된다. 

첫 라인이 실행되면 다른 파이썬 코드가 실행될 수 있는 새로운 컨텍스트로 진입한다. 그리고 모든 블록을 수행하고 나면 컨텍스트가 종료되고 다시 처음 호출한 원래 컨텍스트 관리자 객체의 \_\_exit\_\_ 메서드를 호출한다.

이 경우 외에도 컨텍스트 관리자는 관심사를 분리하고 독립적으로 유지되어야 하는 코드를 분리하는 좋은 방법이다. 